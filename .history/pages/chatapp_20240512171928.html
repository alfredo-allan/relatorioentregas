<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../style/styles.css" />
    <link rel="icon" type="image/x-icon" href="./favicon.ico" />
    <title>ChatApp</title>
  </head>
  <body>
    <header id="ChatApp">
      <img id="menu-icon" src="../img/barra-de-menu.png" alt="" />
      <div id="menu-options">
        <ul>
          <a href="/index.html"><li>Registrar Entrega</li></a>
          <a href="/pages/apagar.html"><li>Apagar Entrega</li></a>
          <a href="/pages/consultar.html"><li>Consultar Entregas</li></a>
          <a href="/pages/registrar.html"><li>Registar-Se</li></a>
        </ul>
      </div>
      <h1 id="textchat">Chat Entregas</h1>
      <!-- <img id="imgchat" src="../img/bater-papo.png" alt="" /> -->
    </header>
    <div id="login">
      <span>Nome</span> <br />
      <input id="nomeusuario" type="text" placeholder="Digite Seu Nome" />
      <img id="utlizador" src="../img/do-utilizador.png" alt="" />
    </div>
    <span>Escolher Usuário</span>
    <ul></ul>
    <div id="usuarios"></div>
    <img id="multiUsu" src="../img/silhueta-de-multiplos-usuarios.png" alt="" />
    <br />
    <input id="lstUsu" type="text" />
    <button style="letter-spacing: 6px" id="ctsUsu">Selecionar</button>

    <div id="msgEnviar">
      <span>Enviar Mensagem</span> <br />
      <textarea
        placeholder="Enviar Menssagem Para Quem ?"
        id="enviarMsg"
        type="text"
      ></textarea>
      <button id="enviarmsg">Enviar</button>
      <button id="delMsg">Deletar Tudo</button>
      <!-- <img id="imgEnviarmsg" src="../img/enviar-mensagem.png" alt="" /> -->
    </div>
  </body>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const nomeUsuarioInput = document.getElementById("nomeusuario");
      let username;
      const lstUsuInput = document.getElementById("lstUsu");
      const ctsUsuButton = document.getElementById("ctsUsu");
      const enviarMsgTextarea = document.getElementById("enviarMsg");
      const deleteMsgButton = document.getElementById("delMsg");
      let intervalId;
      let typing = false;
      let lastTypingTime; // Para rastrear o tempo da última digitação

      ctsUsuButton.addEventListener("click", function () {
        const selectedUsername = lstUsuInput.value;
        if (selectedUsername) {
          enviarMsgTextarea.value = `@${selectedUsername} `;
        } else {
          console.log("Nenhum usuário selecionado.");
        }
      });

      nomeUsuarioInput.addEventListener("change", function () {
        username = nomeUsuarioInput.value;
        // Restante do código para verificar o nome do usuário
      });

      document
        .getElementById("enviarmsg")
        .addEventListener("click", function () {
          const recipientUsername = lstUsuInput.value;
          const message = enviarMsgTextarea.value;
          if (recipientUsername && message) {
            // Restante do código para enviar a mensagem
            typing = false;
            lastTypingTime = new Date().getTime(); // Resetar o tempo da última digitação
            startInterval();
          } else {
            console.log(
              "Por favor, selecione um destinatário e escreva uma mensagem."
            );
          }
        });

      function startInterval() {
        clearInterval(intervalId); // Limpar o intervalo anterior
        intervalId = setInterval(checkAndUpdateUsername, 10000); // Iniciar um novo intervalo
      }

      function pauseInterval() {
        clearInterval(intervalId);
      }

      // Adicionar um evento de entrada no campo de texto para rastrear quando o usuário está digitando
      enviarMsgTextarea.addEventListener("input", function () {
        typing = true;
        lastTypingTime = new Date().getTime();
        pauseInterval(); // Pausar o intervalo enquanto o usuário digita
      });

      // Verificar e atualizar o nome do usuário apenas após um período de inatividade
      function checkAndUpdateUsername() {
        const currentTime = new Date().getTime();
        const timeDiff = currentTime - lastTypingTime;
        if (timeDiff >= 1000 && !typing) {
          // Verificar se o usuário não está digitando e passaram pelo menos 1 segundo desde a última digitação
          // Restante do código para verificar e atualizar o nome do usuário
        }
      }
    });
  </script>
</html>
